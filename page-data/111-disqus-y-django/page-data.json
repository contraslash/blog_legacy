{"componentChunkName":"component---src-templates-blog-post-js","path":"/111-disqus-y-django/","result":{"data":{"site":{"siteMetadata":{"title":"Blog de Contraslash (Legacy)"}},"markdownRemark":{"id":"b716670d-a88b-5c53-8ad0-14a55ce398f4","excerpt":"Disqus y Django Disqus es una plataforma gratuita de comentarios muy famosa, que nos añadir fácilmente una funcionalidad de comentarios a nuestro sitio…","html":"<h1>Disqus y Django</h1>\n<p><a href=\"https://disqus.com\">Disqus</a> es una plataforma gratuita de comentarios muy famosa, que nos añadir fácilmente una funcionalidad de comentarios a nuestro sitio.</p>\n<p>Desplegarlo junto con <a href=\"https://djangoproject.com\">django</a> me ha parecido muy sencillo,</p>\n<p>Primero debemos crear una cuenta en disqus y luego crear un nuevo sitio, y luego get universal code, que nos dará un javascript que debe ser usado en los sitios que queremos que sean comentables.</p>\n<p>Me pareció apropiado crear una aplicación muy sencilla que me sirva específicamente para este propósito, y usarlo templatetags, </p>\n<p>Aquí está el contenido de mis templatetags</p>\n<p><strong>disqus_tags.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django <span class=\"token keyword\">import</span> template\n\nregister <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span>Library<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token decorator annotation punctuation\">@register<span class=\"token punctuation\">.</span>inclusion_tag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"disqus_plugin/disqus_html.html\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">disqus_html</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Render HTMl from Disqus\n    :return:\n    \"\"\"</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\n<span class=\"token decorator annotation punctuation\">@register<span class=\"token punctuation\">.</span>inclusion_tag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"disqus_plugin/disqus_js.html\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">disqus_js</span><span class=\"token punctuation\">(</span>page_url<span class=\"token punctuation\">,</span> page_identifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Render JS from disqus\n    :param page_url: Full page URL\n    :param page_identifier: Unique Page identifier, Must be Unique\n    :return:\n    \"\"\"</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'PAGE_URL'</span><span class=\"token punctuation\">:</span> page_url<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PAGE_IDENTIFIER'</span><span class=\"token punctuation\">:</span> page_identifier\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>y claro, mis htmls\n<strong>disqus_html.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>disqus_thread<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><strong>disqus_js.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n\n<span class=\"token comment\">/**\n *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.\n *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">disqus_config</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>page<span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> <span class=\"token string\">\"{{ PAGE_URL }}\"</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Replace PAGE_URL with your page's canonical URL variable</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>page<span class=\"token punctuation\">.</span>identifier <span class=\"token operator\">=</span> <span class=\"token string\">\"{{ PAGE_IDENTIFIER }}\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Replace PAGE_IDENTIFIER with your page's unique identifier variable</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// DON'T EDIT BELOW THIS LINE</span>\n    <span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> document<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    s<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'//blogcontraslash.disqus.com/embed.js'</span><span class=\"token punctuation\">;</span>\n    s<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-timestamp'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">.</span>head <span class=\"token operator\">||</span> d<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>noscript</span><span class=\"token punctuation\">></span></span>Please enable JavaScript to view the <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://disqus.com/?ref_noscript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>comments powered by Disqus.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>noscript</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>dsq-count-scr<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>//blogcontraslash.disqus.com/count.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Ahora viene lo mágico, este contenido será insertado en mis páginas de detalle del blog, una que posiblemente usted esté viendo en este momento, y para inyectar el contendo del URL de mi página uso un context processor, cuyo contenido está aquí</p>\n<p><strong>context_processor.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">site_name</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    site <span class=\"token operator\">=</span> SimpleLazyObject<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span><span class=\"token punctuation\">:</span> get_current_site<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    protocol <span class=\"token operator\">=</span> <span class=\"token string\">'https'</span> <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>is_secure<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token string\">'http'</span>\n    <span class=\"token keyword\">print</span> site\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'site'</span><span class=\"token punctuation\">:</span> site<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'site_root'</span><span class=\"token punctuation\">:</span> SimpleLazyObject<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{0}://{1}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>protocol<span class=\"token punctuation\">,</span> site<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'full_url'</span><span class=\"token punctuation\">:</span> SimpleLazyObject<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{0}://{1}{2}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>protocol<span class=\"token punctuation\">,</span> site<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'path'</span><span class=\"token punctuation\">:</span> SimpleLazyObject<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{0}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>y por último, la inyección en mi template</p>\n<p><strong>detail_template.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{% block content %}\n...\n    {% disqus_html %}\n...\n{% endblock %}\n{% block specific-js %}\n...\n    {% disqus_js full_url path %}\n...\n{% endblock %}</code></pre></div>","frontmatter":{"title":"Disqus y Django","date":"October 02, 2016","description":"Implementación de Disqus en Django"}}},"pageContext":{"slug":"/111-disqus-y-django/","previous":{"fields":{"slug":"/110-rc4-y-gzip-no-pudiste-conmigo/"},"frontmatter":{"title":"RC4 y Gzip, no pudiste conmigo"}},"next":{"fields":{"slug":"/112-amqp-rabbitmq-y-celery-a-visual-guide-for-dummies/"},"frontmatter":{"title":"AMQP, RabbitMQ y Celery - A Visual Guide for Dummies"}}}}}