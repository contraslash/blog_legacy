{"componentChunkName":"component---src-templates-blog-post-js","path":"/141-using-singularity-containers-in-htcondor/","result":{"data":{"site":{"siteMetadata":{"title":"Blog de Contraslash (Legacy)"}},"markdownRemark":{"id":"a521017a-3485-5db5-88db-7b2013e34eb3","excerpt":"Using Singularity containers in HTCondor Introduction Designed around the notion of extreme mobility of compute and reproducible science, Singularity enables…","html":"<h1>Using Singularity containers in HTCondor</h1>\n<h3>Introduction</h3>\n<p>Designed around the notion of extreme mobility of compute and reproducible science, Singularity enables users to have full control of their operating system environment. </p>\n<h3>Installing Singularity</h3>\n<p>Singularity needs to be installer in a modern linux distribution, it’s installed as follows</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">VERSION=2.2\nwget https://github.com/singularityware/singularity/releases/download/$VERSION/singularity-$VERSION.tar.gz\ntar xvf singularity-$VERSION.tar.gz\ncd singularity-$VERSION\n./configure --prefix=/usr/local\nmake\nsudo make install</code></pre></div>\n<p>Then, check that everything is alright</p>\n<blockquote>\n<p>singularity -v</p>\n</blockquote>\n<h3>Configuring HTCondor</h3>\n<p>It can be used along with HTCondor by adding some entries to the HTCondor configuration file:</p>\n<blockquote>\n<p>sudo nano /etc/condor/config.d/condor_config.local</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Tell HTCondor where is the singularity executable\nSINGULARITY = /usr/local/bin/singularity\n\nSINGULARITY_JOB = (TARGET.DESIRED_OS isnt MY.OpSysAndVer) &amp;&amp; ((TARGET.DESIRED_OS is &quot;CentOS6&quot;) || (TARGET.DESIRED_OS is &quot;CentOS7&quot;))\nSINGULARITY_IMAGE_EXPR = (TARGET.DESIRED_OS is &quot;CentOS6&quot;) ? &quot;/tmp/Centos7.img&quot; : &quot;/tmp/Centos7.img&quot;\n# Maps $_CONDOR_SCRATCH_DIR on the host to /srv inside the image.\nSINGULARITY_TARGET_DIR = /srv\n# Writable scratch directories inside the image.  Auto-deleted after the job exits.\nMOUNT_UNDER_SCRATCH = /tmp, /var/tmp</code></pre></div>\n<p>Then restart HTCondor <code class=\"language-text\">sudo service condor restart</code> and check if the machine has singularity enable.</p>\n<blockquote>\n<p>condor_status -const HasSingularity</p>\n</blockquote>\n<h3>Testing your configuration</h3>\n<p>Lets first create a singularity container from Docker Centos image</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo singularity create --size 2048 /tmp/Centos7.img\nsudo singularity import /tmp/Centos7.img docker://centos:latest\nsudo singularity exec --writable /tmp/Centos7.img  echo &quot;Hello World&quot;  &gt; /tmp/hola</code></pre></div>\n<p>An then, create a HTCondor submit file</p>\n<blockquote>\n<p>nano /tmp/sing.submit</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">executable = /bin/hostname\nuniverse = vanilla\n+SingularityImage = &quot;/tmp/Centos7.img&quot;\n+DESIRED_OS=&quot;CentOS6&quot;\noutput = example1.$(cluster).$(process).out\nerror =  example1.$(cluster).$(process).err\nlog =    example1.$(cluster).$(process).log\nqueue 1</code></pre></div>\n<p>Then execute and wait </p>\n<blockquote>\n<p>condor_submit /tmp/sing.submit</p>\n</blockquote>\n<p>You can find more information <a href=\"http://singularity.lbl.gov/about\">here</a></p>","frontmatter":{"title":"Using Singularity containers in HTCondor","date":"December 17, 2016","description":"Singularity is the new kid in the neighborhood. using containers, it allows reproducibility of a computation"}}},"pageContext":{"slug":"/141-using-singularity-containers-in-htcondor/","previous":{"fields":{"slug":"/140-deep-learning-segun-andrew-ng/"},"frontmatter":{"title":"Deep Learning según Andrew Ng"}},"next":{"fields":{"slug":"/142-usando-los-contenedores-de-singularity-en-htcondor/"},"frontmatter":{"title":"Usando los contenedores de Singularity en HTCondor"}}}}}