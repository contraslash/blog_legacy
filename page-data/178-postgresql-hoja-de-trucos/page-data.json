{"componentChunkName":"component---src-templates-blog-post-js","path":"/178-postgresql-hoja-de-trucos/","result":{"data":{"site":{"siteMetadata":{"title":"Blog de Contraslash (Legacy)"}},"markdownRemark":{"id":"6665753f-b073-505c-90de-cfe5e5f8e271","excerpt":"PostgreSQL Hoja de Trucos Traducido de este gist,  Traducción realizada en este gist PSQL Palabras mágicas: Si ejecutas con la bandera , describirá las…","html":"<h1>PostgreSQL Hoja de Trucos</h1>\n<p>Traducido de <a href=\"https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546\">este gist</a>, </p>\n<p>Traducción realizada en <a href=\"https://gist.github.com/ma0c/c444fa967a570dcfbedcb96b4a0bd909\">este gist</a></p>\n<h1>PSQL</h1>\n<p>Palabras mágicas:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">psql -U postgres</code></pre></div>\n<p>Si ejecutas con la bandera <code class=\"language-text\">-E</code>, describirá las consultas subyacentes que se realizan con los comandos <code class=\"language-text\">\\</code> (genial para aprender).</p>\n<p>La mayora de comandos <code class=\"language-text\">\\d</code> soportan un parámetro adicional del <code class=\"language-text\">__schema__.name__</code> y aceptan comodines como <code class=\"language-text\">*.*</code></p>\n<ul>\n<li><code class=\"language-text\">\\q</code>: Salir</li>\n<li><code class=\"language-text\">\\c __database__</code>: Conectarse a una base de datos</li>\n<li><code class=\"language-text\">\\d __table__</code>: Mostrar la definición de una tabla, incluyendo disparadores</li>\n<li><code class=\"language-text\">\\dt *.*</code>: Lista todas las tablas de todos los esquemas (Si no se coloca <em>.</em> solamente se buscaran los pertenecientes ap SEARCH_PATH)</li>\n<li><code class=\"language-text\">\\l</code>: Lista de las bases de datos</li>\n<li><code class=\"language-text\">\\dn</code>: Lista de los esquemas</li>\n<li><code class=\"language-text\">\\df</code>: Lista de las funciones</li>\n<li><code class=\"language-text\">\\dv</code>: Lista de las vistas</li>\n<li><code class=\"language-text\">\\df+ __function__</code> : Muestra el código SQL de una funcin</li>\n<li><code class=\"language-text\">\\x</code>: Da una salida mas elaborada mostrando los resultados de la consulta </li>\n</ul>\n<p>Relacionadas con usuarios:</p>\n<ul>\n<li><code class=\"language-text\">\\du</code>: Lista de usuarios</li>\n<li><code class=\"language-text\">\\du __username__</code>: Lista la información de un usuario si está presente</li>\n<li><code class=\"language-text\">create user __username__ with password &#39;password&#39;</code>: Crea un usuario <strong>username</strong> con contrasea password</li>\n<li><code class=\"language-text\">create role __test1__</code>: Crea un rol con un nombre de usuario específico</li>\n<li><code class=\"language-text\">create role __test2__ noinherit login password __passsword__;</code>: Crea un rol con un usuario y contraseña</li>\n<li><code class=\"language-text\">set role __test__;</code>: Cambia el rol de la sesión actual a <code class=\"language-text\">__test__</code></li>\n<li><code class=\"language-text\">grant __test2__ to __test1__;</code>: Permite a <code class=\"language-text\">__test1__</code> definir su rol como <code class=\"language-text\">__test2__</code></li>\n</ul>\n<h2>Configuración</h2>\n<ul>\n<li>\n<p>Comandos de gestin de servicio:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo service postgresql stop\nsudo service postgresql start\nsudo service postgresql restart</code></pre></div>\n</li>\n<li>\n<p>Cambiar la verbosidad del log de Postgtgres:\n<br/>1) Primero edita el archivo de configuración, defone un log que te satisfaga, luego guarda y reinicia postgres:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo vim /etc/postgresql/9.x/main/postgresql.conf</code></pre></div>\n</li>\n</ul>\n<h1>Uncomment/Change inside:</h1>\n<p>log<em>min</em>messages = debug5\nlog<em>min</em>error<em>statement = debug5\nlog</em>min<em>duration</em>statement = -1</p>\n<p>sudo service postgresql restart</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  2) Ahora puedes ver toneladas de detalles por cada sentencia, error e incluso tareas ejecutándose en segundo plano.</code></pre></div>\n<p>tail -f /var/log/postgresql/postgresql-9.x-main.log</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  3) Se puede añadir quien ejecuto la sentencia en el log, editando el archivo `postgresql.conf`:</code></pre></div>\n<p>log<em>line</em>prefix = ‘%t %u %d %a ’</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">## Consultas útiles\n- `SELECT * FROM pg_proc WHERE proname=&#39;__procedurename__&#39;`: Lista los procedimientos/funciones\n- `SELECT * FROM pg_views WHERE viewname=&#39;__viewname__&#39;;`: Lista las vistas, incluidas las definiciones\n- `SELECT pg_size_pretty(pg_total_relation_size(&#39;__table_name__&#39;));`: Muestra la el espacio de tablas en uso.\n- `SELECT pg_size_pretty(pg_database_size(&#39;__database_name__&#39;));`: Muestra el espacio de base de datos en uso\n- `show statement_timeout;`: Muestra el tiempo límite de finalización de la consulta.\n- `SELECT * FROM pg_indexes WHERE tablename=&#39;__table_name__&#39; AND schemaname=&#39;__schema_name__&#39;;`: Muestra los índices de las tablas\n- Obtener todos los índices de todas las tablas de un esquema:\n```sql\nSELECT\n   t.relname AS table_name,\n   i.relname AS index_name,\n   a.attname AS column_name\nFROM\n   pg_class t,\n   pg_class i,\n   pg_index ix,\n   pg_attribute a,\n    pg_namespace n\nWHERE\n   t.oid = ix.indrelid\n   AND i.oid = ix.indexrelid\n   AND a.attrelid = t.oid\n   AND a.attnum = ANY(ix.indkey)\n   AND t.relnamespace = n.oid\n    AND n.nspname = &#39;kartones&#39;\nORDER BY\n   t.relname,\n   i.relname</code></pre></div>\n<ul>\n<li>\n<p>Ejecutar datos:</p>\n<ul>\n<li>\n<p>Consutas a ser ejecutadas en una base de datos específica:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> datname<span class=\"token punctuation\">,</span> application_name<span class=\"token punctuation\">,</span> pid<span class=\"token punctuation\">,</span> backend_start<span class=\"token punctuation\">,</span> query_start<span class=\"token punctuation\">,</span> state_change<span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">,</span> query \n<span class=\"token keyword\">FROM</span> pg_stat_activity \n<span class=\"token keyword\">WHERE</span> datname<span class=\"token operator\">=</span><span class=\"token string\">'__database_name__'</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Obtener todas las consultas a todas las bases de datos esperando por datos. </p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> pg_stat_activity <span class=\"token keyword\">WHERE</span> waiting<span class=\"token operator\">=</span><span class=\"token string\">'t'</span></code></pre></div>\n</li>\n<li>\n<p>Consultas ejecutandose con su identificador de procesos:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> pg_stat_get_backend_pid<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>backendid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> procpid<span class=\"token punctuation\">,</span> \npg_stat_get_backend_activity<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>backendid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> current_query\n<span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> pg_stat_get_backend_idset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> backendid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> s<span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<p>Casting:</p>\n<ul>\n<li><code class=\"language-text\">CAST (column AS type)</code> or <code class=\"language-text\">column::type</code></li>\n<li><code class=\"language-text\">&#39;__table_name__&#39;::regclass::oid</code>: Obtener el identificador dado el nombre de la tabla</li>\n</ul>\n<h2>Herramientas</h2>\n<ul>\n<li><a href=\"http://ptop.projects.pgfoundry.org/\">pg-top</a>: <code class=\"language-text\">top</code> para PG. <code class=\"language-text\">sudo apt-get install ptop</code> + <code class=\"language-text\">pg_top</code></li>\n<li>\n<p><a href=\"https://dba.stackexchange.com/questions/63453/is-there-a-psql-equivalent-of-bashs-reverse-search-history\">Búsqueda inversa en PG como la de Unix</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"bind \"</span>^R<span class=\"token string\">\" em-inc-search-prev\"</span> <span class=\"token operator\">></span> <span class=\"token environment constant\">$HOME</span>/.editrc\n$ <span class=\"token builtin class-name\">source</span> <span class=\"token environment constant\">$HOME</span>/.editrc</code></pre></div>\n</li>\n</ul>","frontmatter":{"title":"PostgreSQL Hoja de Trucos","date":"September 04, 2017","description":"Hoja de trucos y atajos útiles para el manejo de PostgreSQL"}}},"pageContext":{"slug":"/178-postgresql-hoja-de-trucos/","previous":{"fields":{"slug":"/177-usando-browsersync-en-un-proyecto-django/"},"frontmatter":{"title":"Usando BrowserSync en un proyecto Django"}},"next":{"fields":{"slug":"/179-archivos-estaticos-en-s3-con-django/"},"frontmatter":{"title":"Archivos estáticos en S3 con Django"}}}}}