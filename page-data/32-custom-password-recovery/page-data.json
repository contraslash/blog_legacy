{"componentChunkName":"component---src-templates-blog-post-js","path":"/32-custom-password-recovery/","result":{"data":{"site":{"siteMetadata":{"title":"Blog de Contraslash (Legacy)"}},"markdownRemark":{"id":"c1256c37-614e-5a95-8d72-63a3a1c4dad4","excerpt":"Recuperación de contraseña personalizada Tomado de garmoncheg Tenía que hacer  una tarea recientemente. Se trataba de agregar una mecanismo para recuperar…","html":"<h1>Recuperación de contraseña personalizada</h1>\n<p>Tomado de <a href=\"http://garmoncheg.blogspot.com.au/2012/07/django-resetting-passwords-with.html\">garmoncheg</a></p>\n<p>Tenía que hacer  una tarea recientemente. Se trataba de agregar una mecanismo para recuperar contraseña en un proyecto de django. Nosotros teníamos nuestro propio sistema de registro funcionando …\nEra un proyecto del sector corporativo, así que no podías irte registrando por ti mismo. Administradores, probablemente con sincronización  LDAP, registraban tu email/login en el sistema. Así que tenías que definir tu propia contraseña. Por razones de seguridad, no podías registrarte. Punto.</p>\n<p>Primero, traté de encontrar una decisión estándar, así que revisé <a href=\"https://pypi.python.org/pypi/django-registration/\">django-registration</a> y <a href=\"https://github.com/brutasse/django-password-reset\">django password-reset</a>. Estas eran unas increibles herramientas para instalar y  continuar, pero necesitaba una solución un poco mas compleja,  y la idea de que tu propia bicicleta es siempre mejor, así que me decidí por usar el administrador de django y ví que estaban las harramientas para ser usadas sin perder tiempo. Actualmente django.contrib.auth hace parte de Dajgno, pero tiene la UI del admin de django. Tu puedes encontrar las herramientas que necesitas aquí:</p>\n<ul>\n<li>password_reset</li>\n<li>password_reset_done </li>\n<li>password_reset_confirm </li>\n<li>password_reset_complete </li>\n</ul>\n<p>Para usar este método, primero debes:</p>\n<h3>1. Confiturar el email:</h3>\n<p>Tu proyecto de Django, tipicamente tiene espacio para variables de correo SMTP en <strong>settings.py</strong>. Usualmente tu necesitas esto en producción para enviar errores a los administradores de errores <strong>500</strong> y/o alertas del sistema. Para nuestras necesitades, python tiene su propio servidor de email. Yo prefiero usar esto para propositos de <em>degug</em>, así que una buena manera de usar esto únicamente en caso de debug es agregando esta líneas en <strong>settings.py</strong>:</p>\n<h6>settings.py</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if DEBUG:\n    EMAIL_HOST = &#39;localhost&#39;\n    EMAIL_PORT = 1025\n    EMAIL_HOST_USER = &#39;&#39;\n    EMAIL_HOST_PASSWORD = &#39;&#39;\n    EMAIL_USE_TLS = False\n    DEFAULT_FROM_EMAIL = &#39;testing@example.com&#39;</code></pre></div>\n<p>Aquí tu tendrás tu propio servidor de email en un puerto alternativo. Para producción podrías entrar las configuraciones de Sendmail (o cualquiera que uses)</p>\n<p>Ahora tu podrías ser capaz de iniciar el servidor ejecutando en el servidor:</p>\n<p><code class=\"language-text\">python -m smtpd -n -c DebuggingServer localhost:1025</code></p>\n<h3>2.Confirurar las Urls:</h3>\n<h6>urls.py</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">urlpatterns = patterns(&#39;&#39;,\n    url(r&#39;^user/password/reset/$&#39;, \n        &#39;django.contrib.auth.views.password_reset&#39;, \n        {&#39;post_reset_redirect&#39; : &#39;/user/password/reset/done/&#39;},\n        name=&quot;password_reset&quot;),\n    (r&#39;^user/password/reset/done/$&#39;,\n        &#39;django.contrib.auth.views.password_reset_done&#39;),\n    (r&#39;^user/password/reset/(?P&lt;uidb36&gt;[0-9A-Za-z]+)-(?P&lt;token&gt;.+)/$&#39;, \n        &#39;django.contrib.auth.views.password_reset_confirm&#39;, \n        {&#39;post_reset_redirect&#39; : &#39;/user/password/done/&#39;}),\n    (r&#39;^user/password/done/$&#39;, \n        &#39;django.contrib.auth.views.password_reset_complete&#39;),\n    # ...\n)</code></pre></div>\n<blockquote>\n<ul>\n<li>Django 1.6 y superior requiere uidb64 en lugar de uidb36</li>\n</ul>\n</blockquote>\n<h3>3. Agregar</h3>\n<p>Tu tienes templates para recuperar las contraseñas.\nDjango tiene los templates del administrador aquí, pero creo que tu podrías querer templates personalizados a tus necesidades, así que básicamente lo que tienes que hacer es sobreescribir esos templates, especificando tus templates en el path de django. Los templates de Django son:</p>\n<ul>\n<li>registration/password<em>reset</em>form.html</li>\n<li>registration/password<em>reset</em>done.html</li>\n<li>registration/password<em>reset</em>confirm.html</li>\n<li>registration/password<em>reset</em>complete.html</li>\n</ul>\n<p>Template del email</p>\n<ul>\n<li>registration/password<em>reset</em>email.html </li>\n</ul>\n<p>Colocaré abajo los templates que yo he usado, de acuerdo con la filosofía de <em>baterías incluidas</em> de Django</p>\n<h6>registration/password<em>reset</em>form.html</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{% extends &quot;base.html&quot; %}\n\n{% block title %}Reset Password{% endblock %}\n\n{% block content %}\n&lt;p&gt;Especifique su email para enviarle las instrucciones para la recuperación de contraseña.&lt;/p&gt;\n\n\u0002wzxhzdk:0\u0003\n\n{% endblock %}</code></pre></div>\n<h6>registration/password<em>reset</em>done.html</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{% extends &quot;base.html&quot; %}\n\n{% block title %}Recuperación de contraseña exitosa{% endblock %}\n\n{% block content %}\n&lt;p&gt;Hemos enviado las instrucciones de como recuperar la contraseña a la dirección de correo electrónico especificada&lt;/p&gt;\n&lt;p&gt;Estarás recibiendo el correo proto.&lt;/p&gt;\n{% endblock %}</code></pre></div>\n<h6>registration/password<em>reset</em>confirm.html</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{% extends &quot;base.html&quot; %}\n{% block title %}Definir nueva contraseña{% endblock %}\n\n{% block content %}\n    {% if validlink %}\n        &lt;p&gt;Por favor ingrese su nueva contraseña dos veces.&lt;br /&gt;\n          Así podremos verificar que es correcta.&lt;/p&gt;\n        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;\n            &lt;div style=&quot;display:none&quot;&gt;\n                &lt;input type=&quot;hidden&quot; value=&quot;{{ csrf_token }}&quot; name=&quot;csrfmiddlewaretoken&quot;&gt;\n            &lt;/div&gt;\n            &lt;table&gt;\n                &lt;tr&gt;\n                    &lt;td&gt;{{ form.new_password1.errors }}\n                        &lt;label for=&quot;id_new_password1&quot;&gt;Nueva contraseña:&lt;/label&gt;&lt;/td&gt;\n                    &lt;td&gt;{{ form.new_password1 }}&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td&gt;{{ form.new_password2.errors }}\n                        &lt;label for=&quot;id_new_password2&quot;&gt;Confirmar contraseña:&lt;/label&gt;&lt;/td&gt;\n                    &lt;td&gt;{{ form.new_password2 }}&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td&gt;&lt;/td&gt;\n                    &lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Cambiar mi contraseña&quot; /&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/table&gt;\n        &lt;/form&gt;\n    {% else %}\n        &lt;h1&gt;Recuperación de contraseña fallida&lt;/h1&gt;\n        &lt;p&gt;El vínculo de recuperación de contraseña es inválido, &lt;br /&gt;\n        Posiblemente ya ha sido usado &lt;br /&gt;\n        Por favor solicite una nueva contraseña.&lt;/p&gt;\n    {% endif %}\n{% endblock %}</code></pre></div>\n<h6>registration/password<em>reset</em>complete.html</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{% extends &quot;base.html&quot; %}\n\n{% block title %}Password reset complete{% endblock %}\n\n{% block content %}\n&lt;p&gt;Tu contraseña ha sido definida. Ya puedes iniciar sesión de nuevo&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;{{ login_url }}&quot;&gt;Iniciar sesión&lt;/a&gt;&lt;/p&gt;\n{% endblock %}</code></pre></div>\n<h6>registration/password<em>reset</em>email.html</h6>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{% autoescape off %}\nEstá recibiendo este correo porque solicitó un cambio de contraseña en {{ site_name }}.\n\nPor favor vaya a esta página y configure su nueva constreña\n{% block reset_link %}\n{{ protocol }}://{{ domain }}{% url django.contrib.auth.views.password_reset_confirm uidb36=uid, token=token %}\n{% endblock %}\n\nSu nombre de usuario en caso que lo haya olvidado: {{ user.username }}\n\nGracias por usar nuestro sitio!\n\nEl equipo{{ site_name }}.\n\n{% endautoescape %}</code></pre></div>\n<p>Así que tu estás teniendo un sistema de recuperación de contraseña <em>fuera de la caja</em>, usando las herrramientas incluidas en Django, con poco tiempo.</p>\n<p>Comentame!</p>\n<blockquote>\n<p>Si crees que la traducción puede mejorar o tienes alguna opinión, envíame un <a href=\"mailto://ma0acollazos@gmail.com\">correo</a></p>\n</blockquote>","frontmatter":{"title":"Recuperación de contraseña personalizada","date":"January 29, 2016","description":""}}},"pageContext":{"slug":"/32-custom-password-recovery/","previous":{"fields":{"slug":"/33-reverse-lazy-with-args/"},"frontmatter":{"title":"Reverse Lazy with args"}},"next":{"fields":{"slug":"/34-curso-de-python/"},"frontmatter":{"title":"Curso de Python"}}}}}